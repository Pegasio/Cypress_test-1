
&НаКлиенте
Процедура Печать(Команда)
	ПечатьНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПечатьНаСервере()
	ОбработкаОбъект = РеквизитФормыВЗначение("Объект");
	СсылкаМакет = ОбработкаОбъект.ПолучитьМакет("Договор");	
	Word = СсылкаМакет.Получить();
     ПараметрыВалюты="рубль, рубля, рублей, м, копейка, копейки, копеек, ж, 2";
	 ФИОКлиента=СтрРазделить(Объект.Клиент, " ");
     ИнициалыКлиента=ФИОКлиента[0]+". "+Лев(ФИОКлиента[1],1)+". "+Лев(ФИОКлиента[2],1);
	 ФИОСотрудника=СтрРазделить(Объект.Сотрудник, " ");
	 ИнициалыСотрудника=ФИОСотрудника[0]+". "+Лев(ФИОСотрудника[1],1)+". "+Лев(ФИОСотрудника[2],1);
	 ДолжностьСотрудника=Справочники.Сотрудники.НайтиПоНаименованию(Объект.Сотрудник).Должность;
	//открываем и активируем документ
	СсылкаМакет = Word.Application.Documents(1);
	СсылкаМакет.Activate();         
	Замена=СсылкаМакет.Content.Find;
	ДатаДоговора=Формат(Объект.Дата, "ДФ=dd.MM.yyyy");
	СрокВозврата=Формат(Объект.Срок_возврата_займа, "ДФ=dd.MM.yyyy");
	КоличествоДней=(НачалоДня(Объект.Срок_возврата_займа)-НачалоДня(Объект.Дата))/60/60/24;

	Замена.Execute("НомерДоговора", , , , , , , , ,Объект.Номер,2 );
	Замена.Execute("ДатаДоговора", , , , , , , , ,ДатаДоговора,2 );
	Замена.Execute("ФИО", , , , , , , , ,Объект.Клиент.Наименование,2 );
	Замена.Execute("ДатаРождения", , , , , , , , ,Объект.Клиент.Дата_рождения,2 );
	Замена.Execute("МестоЖительства", , , , , , , , ,Объект.Клиент.Место_жительства,2 );
	Замена.Execute("ПаспортКлиента", , , , , , , , ,Объект.Клиент.Паспорт,2 );
	Замена.Execute("СуммаЗайма", , , , , , , , ,Объект.Сумма_займа,2 );
	Замена.Execute("НомерКлиента", , , , , , , , ,Объект.Клиент.Номер_телефона,2 );	
	Замена.Execute("СрокВозвратаЗайма", , , , , , , , ,СрокВозврата,2 );	
	Замена.Execute("СрокДоговора", , , , , , , , ,КоличествоДней,2 );
	Замена.Execute("СтоимостьЗайма", , , , , , , , ,Строка(Цел(Объект.Сумма_займа))+" руб. "+Строка((Объект.Сумма_займа-Цел(Объект.Сумма_займа))*100)+" коп.",2);  
	Замена.Execute("ЗаймПрописью", , , , , , , , ,ЧислоПрописью(Объект.Сумма_займа,,ПараметрыВалюты) ,2 );
	Замена.Execute("ИнициалыКлиента", , , , , , , , ,ИнициалыКлиента,2);
	Замена.Execute("ИнициалыСотрудника", , , , , , , , ,ИнициалыСотрудника,2 );
	Замена.Execute("ДолжностьСотрудника", , , , , , , , ,Строка(ДолжностьСотрудника) ,2 );



             
        //Выделяем обязательную закладку начала таблицы
        СсылкаМакет.Bookmarks("Таблица1").Select();
         
         
        //Перемещаемся вниз, выделяем строку таблицы и копируем ее в буфер обмена
        СсылкаМакет.Application.Selection.MoveDown();
        СсылкаМакет.Application.Selection.SelectRow();
        СсылкаМакет.Application.Selection.Copy();
         Счетчик=0;
        Для каждого Строка из Объект.Вещи Цикл
            Сообщить(Строка.Наименование_вещи); 
          	СсылкаМакет.Application.Selection.Find.Execute("Номер" ,,,,,,,,,Строка.НомерСтроки,2);
            СсылкаМакет.Application.Selection.Find.Execute("НаименованиеВещи" ,,,,,,,,,Строка.Наименование_вещи,2);
            СсылкаМакет.Application.Selection.Find.Execute("ОписаниеВещи" ,,,,,,,,,Строка.Описание_вещи,2);
            //Последний параметр поиска пустой
            СсылкаМакет.Application.Selection.Find.Execute("ОценкаВещи" ,,,,,,,,,Строка(Цел(Строка.Оценка_вещи))+" руб. "+Строка((Строка.Оценка_вещи-Цел(Строка.Оценка_вещи))*100)+" коп.",2);
             
            //Перемещаемся вниз, вставляем из буфера обмена строку
            СсылкаМакет.Application.Selection.MoveDown();
            СсылкаМакет.Application.Selection.Paste();
            //Перемещаемся вверх и выделяем строку для замены значений
            СсылкаМакет.Application.Selection.MoveUp();
            СсылкаМакет.Application.Selection.SelectRow();
             
		КонецЦикла;
		Сообщить(ЧислоПрописью(Объект.Сумма_оценки,,ПараметрыВалюты));
        Замена.Execute("СуммаОценки", , , , , , , , ,Строка(Объект.Сумма_оценки)+" "+"руб"+", "+ЧислоПрописью(Объект.Сумма_оценки,,ПараметрыВалюты) ,2 );
 
        //Вырезаем лишнюю строку
        СсылкаМакет.Application.Selection.Cut();
         
        //Скрываем обязательную закладку начала таблицы
        СсылкаМакет.Bookmarks("Таблица1").Select();
        СсылкаМакет.Application.Selection.TypeText(" ");
	
	//включаем видимость приложения
	СсылкаМакет.Application.Visible = Истина;
	         КонецПроцедуры

	

&НаКлиенте
Процедура ВещиОценка_ВещиПриИзменении(Элемент)
	ИтогОценки=0;
	КоличествоДней=(НачалоДня(Объект.Срок_возврата_займа)-НачалоДня(Объект.Дата))/60/60/24;
	Для каждого Строка из Объект.Вещи Цикл
		   ИтогОценки=ИтогОценки+Строка.Оценка_Вещи;
	   КонецЦикла;
	   Объект.Сумма_оценки=ИтогОценки;
	   Объект.Комисионные=(Объект.Сумма_оценки*10*КоличествоДней)/365;
	   Объект.Сумма_займа=Объект.Сумма_оценки+Объект.Комисионные;
	   Сообщить(КоличествоДней);
	   Сообщить((Объект.Сумма_оценки*0.7)/(365*КоличествоДней));

КонецПроцедуры



&НаСервере
  Процедура Срок_возврата_займаПриИзмененииНаСервере()
	  	ИтогОценки=0;
	КоличествоДней=(НачалоДня(Объект.Срок_возврата_займа)-НачалоДня(Объект.Дата))/60/60/24;
	Для каждого Строка из Объект.Вещи Цикл
		   ИтогОценки=ИтогОценки+Строка.Оценка_Вещи;
	   КонецЦикла;
	   Объект.Сумма_оценки=ИтогОценки;
	   Объект.Комисионные=(Объект.Сумма_оценки*2.92*КоличествоДней)/365;
	   Объект.Сумма_займа=Объект.Сумма_оценки+Объект.Комисионные;
	   Сообщить(КоличествоДней);
	   Сообщить((Объект.Сумма_оценки*0.7)/(365*КоличествоДней));
  КонецПроцедуры

&НаКлиенте
  Процедура Срок_возврата_займаПриИзменении(Элемент)
	  Срок_возврата_займаПриИзмененииНаСервере();
  КонецПроцедуры

&НаСервере
Процедура ПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
  КонецПроцедуры

&НаСервере
  Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	  	  	  Для каждого Строка из Объект.Вещи Цикл
				НовыйЭлемент = Справочники.Заложенные_вещи.СоздатьЭлемент();
				НовыйЭлемент.Наименование = Строка.Наименование_вещи ; 
				НовыйЭлемент.Описание = Строка.Описание_вещи ; 
				НовыйЭлемент.Оценка_вещи = Строка.Оценка_вещи ;
				НовыйЭлемент.Номер_договора = Документы.Договор.НайтиПоНомеру(Объект.Номер) ; 
				НовыйЭлемент.Записать();
КонецЦикла;


  КонецПроцедуры

&НаСервере
  Процедура ОбработкаПроверкиЗаполненияНаСервере(Отказ, ПроверяемыеРеквизиты)
	  Объект.Текущая_сумма_займа=Объект.Сумма_займа;
  КонецПроцедуры




  